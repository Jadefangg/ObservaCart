{"ast":null,"code":"/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { PerformanceTimingNames as PTN } from './enums/PerformanceTimingNames';\nimport { hrTimeToNanoseconds, timeInputToHrTime, urlMatches } from '@opentelemetry/core';\nimport { SemanticAttributes } from '@opentelemetry/semantic-conventions';\n// Used to normalize relative URLs\nvar a;\nexport function getUrlNormalizingAnchor() {\n  if (!a) {\n    a = document.createElement('a');\n  }\n  return a;\n}\n/**\n * Helper function to be able to use enum as typed key in type and in interface when using forEach\n * @param obj\n * @param key\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function hasKey(obj, key) {\n  return key in obj;\n}\n/**\n * Helper function for starting an event on span based on {@link PerformanceEntries}\n * @param span\n * @param performanceName name of performance entry for time start\n * @param entries\n */\nexport function addSpanNetworkEvent(span, performanceName, entries) {\n  if (hasKey(entries, performanceName) && typeof entries[performanceName] === 'number') {\n    span.addEvent(performanceName, entries[performanceName]);\n    return span;\n  }\n  return undefined;\n}\n/**\n * Helper function for adding network events\n * @param span\n * @param resource\n */\nexport function addSpanNetworkEvents(span, resource) {\n  addSpanNetworkEvent(span, PTN.FETCH_START, resource);\n  addSpanNetworkEvent(span, PTN.DOMAIN_LOOKUP_START, resource);\n  addSpanNetworkEvent(span, PTN.DOMAIN_LOOKUP_END, resource);\n  addSpanNetworkEvent(span, PTN.CONNECT_START, resource);\n  addSpanNetworkEvent(span, PTN.SECURE_CONNECTION_START, resource);\n  addSpanNetworkEvent(span, PTN.CONNECT_END, resource);\n  addSpanNetworkEvent(span, PTN.REQUEST_START, resource);\n  addSpanNetworkEvent(span, PTN.RESPONSE_START, resource);\n  addSpanNetworkEvent(span, PTN.RESPONSE_END, resource);\n  var encodedLength = resource[PTN.ENCODED_BODY_SIZE];\n  if (encodedLength !== undefined) {\n    span.setAttribute(SemanticAttributes.HTTP_RESPONSE_CONTENT_LENGTH, encodedLength);\n  }\n  var decodedLength = resource[PTN.DECODED_BODY_SIZE];\n  // Spec: Not set if transport encoding not used (in which case encoded and decoded sizes match)\n  if (decodedLength !== undefined && encodedLength !== decodedLength) {\n    span.setAttribute(SemanticAttributes.HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED, decodedLength);\n  }\n}\n/**\n * sort resources by startTime\n * @param filteredResources\n */\nexport function sortResources(filteredResources) {\n  return filteredResources.slice().sort(function (a, b) {\n    var valueA = a[PTN.FETCH_START];\n    var valueB = b[PTN.FETCH_START];\n    if (valueA > valueB) {\n      return 1;\n    } else if (valueA < valueB) {\n      return -1;\n    }\n    return 0;\n  });\n}\n/**\n * Get closest performance resource ignoring the resources that have been\n * already used.\n * @param spanUrl\n * @param startTimeHR\n * @param endTimeHR\n * @param resources\n * @param ignoredResources\n * @param initiatorType\n */\nexport function getResource(spanUrl, startTimeHR, endTimeHR, resources, ignoredResources, initiatorType) {\n  if (ignoredResources === void 0) {\n    ignoredResources = new WeakSet();\n  }\n  // de-relativize the URL before usage (does no harm to absolute URLs)\n  var urlNormalizingAnchor = getUrlNormalizingAnchor();\n  urlNormalizingAnchor.href = spanUrl;\n  spanUrl = urlNormalizingAnchor.href;\n  var filteredResources = filterResourcesForSpan(spanUrl, startTimeHR, endTimeHR, resources, ignoredResources, initiatorType);\n  if (filteredResources.length === 0) {\n    return {\n      mainRequest: undefined\n    };\n  }\n  if (filteredResources.length === 1) {\n    return {\n      mainRequest: filteredResources[0]\n    };\n  }\n  var sorted = sortResources(filteredResources);\n  var parsedSpanUrl = parseUrl(spanUrl);\n  if (parsedSpanUrl.origin !== window.location.origin && sorted.length > 1) {\n    var corsPreFlightRequest = sorted[0];\n    var mainRequest = findMainRequest(sorted, corsPreFlightRequest[PTN.RESPONSE_END], endTimeHR);\n    var responseEnd = corsPreFlightRequest[PTN.RESPONSE_END];\n    var fetchStart = mainRequest[PTN.FETCH_START];\n    // no corsPreFlightRequest\n    if (fetchStart < responseEnd) {\n      mainRequest = corsPreFlightRequest;\n      corsPreFlightRequest = undefined;\n    }\n    return {\n      corsPreFlightRequest: corsPreFlightRequest,\n      mainRequest: mainRequest\n    };\n  } else {\n    return {\n      mainRequest: filteredResources[0]\n    };\n  }\n}\n/**\n * Will find the main request skipping the cors pre flight requests\n * @param resources\n * @param corsPreFlightRequestEndTime\n * @param spanEndTimeHR\n */\nfunction findMainRequest(resources, corsPreFlightRequestEndTime, spanEndTimeHR) {\n  var spanEndTime = hrTimeToNanoseconds(spanEndTimeHR);\n  var minTime = hrTimeToNanoseconds(timeInputToHrTime(corsPreFlightRequestEndTime));\n  var mainRequest = resources[1];\n  var bestGap;\n  var length = resources.length;\n  for (var i = 1; i < length; i++) {\n    var resource = resources[i];\n    var resourceStartTime = hrTimeToNanoseconds(timeInputToHrTime(resource[PTN.FETCH_START]));\n    var resourceEndTime = hrTimeToNanoseconds(timeInputToHrTime(resource[PTN.RESPONSE_END]));\n    var currentGap = spanEndTime - resourceEndTime;\n    if (resourceStartTime >= minTime && (!bestGap || currentGap < bestGap)) {\n      bestGap = currentGap;\n      mainRequest = resource;\n    }\n  }\n  return mainRequest;\n}\n/**\n * Filter all resources that has started and finished according to span start time and end time.\n *     It will return the closest resource to a start time\n * @param spanUrl\n * @param startTimeHR\n * @param endTimeHR\n * @param resources\n * @param ignoredResources\n */\nfunction filterResourcesForSpan(spanUrl, startTimeHR, endTimeHR, resources, ignoredResources, initiatorType) {\n  var startTime = hrTimeToNanoseconds(startTimeHR);\n  var endTime = hrTimeToNanoseconds(endTimeHR);\n  var filteredResources = resources.filter(function (resource) {\n    var resourceStartTime = hrTimeToNanoseconds(timeInputToHrTime(resource[PTN.FETCH_START]));\n    var resourceEndTime = hrTimeToNanoseconds(timeInputToHrTime(resource[PTN.RESPONSE_END]));\n    return resource.initiatorType.toLowerCase() === (initiatorType || 'xmlhttprequest') && resource.name === spanUrl && resourceStartTime >= startTime && resourceEndTime <= endTime;\n  });\n  if (filteredResources.length > 0) {\n    filteredResources = filteredResources.filter(function (resource) {\n      return !ignoredResources.has(resource);\n    });\n  }\n  return filteredResources;\n}\n/**\n * Parses url using anchor element\n * @param url\n */\nexport function parseUrl(url) {\n  var a = document.createElement('a');\n  a.href = url;\n  return a;\n}\n/**\n * Get element XPath\n * @param target - target element\n * @param optimised - when id attribute of element is present the xpath can be\n * simplified to contain id\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function getElementXPath(target, optimised) {\n  if (target.nodeType === Node.DOCUMENT_NODE) {\n    return '/';\n  }\n  var targetValue = getNodeValue(target, optimised);\n  if (optimised && targetValue.indexOf('@id') > 0) {\n    return targetValue;\n  }\n  var xpath = '';\n  if (target.parentNode) {\n    xpath += getElementXPath(target.parentNode, false);\n  }\n  xpath += targetValue;\n  return xpath;\n}\n/**\n * get node index within the siblings\n * @param target\n */\nfunction getNodeIndex(target) {\n  if (!target.parentNode) {\n    return 0;\n  }\n  var allowedTypes = [target.nodeType];\n  if (target.nodeType === Node.CDATA_SECTION_NODE) {\n    allowedTypes.push(Node.TEXT_NODE);\n  }\n  var elements = Array.from(target.parentNode.childNodes);\n  elements = elements.filter(function (element) {\n    var localName = element.localName;\n    return allowedTypes.indexOf(element.nodeType) >= 0 && localName === target.localName;\n  });\n  if (elements.length >= 1) {\n    return elements.indexOf(target) + 1; // xpath starts from 1\n  }\n  // if there are no other similar child xpath doesn't need index\n  return 0;\n}\n/**\n * get node value for xpath\n * @param target\n * @param optimised\n */\nfunction getNodeValue(target, optimised) {\n  var nodeType = target.nodeType;\n  var index = getNodeIndex(target);\n  var nodeValue = '';\n  if (nodeType === Node.ELEMENT_NODE) {\n    var id = target.getAttribute('id');\n    if (optimised && id) {\n      return \"//*[@id=\\\"\" + id + \"\\\"]\";\n    }\n    nodeValue = target.localName;\n  } else if (nodeType === Node.TEXT_NODE || nodeType === Node.CDATA_SECTION_NODE) {\n    nodeValue = 'text()';\n  } else if (nodeType === Node.COMMENT_NODE) {\n    nodeValue = 'comment()';\n  } else {\n    return '';\n  }\n  // if index is 1 it can be omitted in xpath\n  if (nodeValue && index > 1) {\n    return \"/\" + nodeValue + \"[\" + index + \"]\";\n  }\n  return \"/\" + nodeValue;\n}\n/**\n * Checks if trace headers should be propagated\n * @param spanUrl\n * @private\n */\nexport function shouldPropagateTraceHeaders(spanUrl, propagateTraceHeaderCorsUrls) {\n  var propagateTraceHeaderUrls = propagateTraceHeaderCorsUrls || [];\n  if (typeof propagateTraceHeaderUrls === 'string' || propagateTraceHeaderUrls instanceof RegExp) {\n    propagateTraceHeaderUrls = [propagateTraceHeaderUrls];\n  }\n  var parsedSpanUrl = parseUrl(spanUrl);\n  if (parsedSpanUrl.origin === window.location.origin) {\n    return true;\n  } else {\n    return propagateTraceHeaderUrls.some(function (propagateTraceHeaderUrl) {\n      return urlMatches(spanUrl, propagateTraceHeaderUrl);\n    });\n  }\n}","map":{"version":3,"names":["PerformanceTimingNames","PTN","hrTimeToNanoseconds","timeInputToHrTime","urlMatches","SemanticAttributes","a","getUrlNormalizingAnchor","document","createElement","hasKey","obj","key","addSpanNetworkEvent","span","performanceName","entries","addEvent","undefined","addSpanNetworkEvents","resource","FETCH_START","DOMAIN_LOOKUP_START","DOMAIN_LOOKUP_END","CONNECT_START","SECURE_CONNECTION_START","CONNECT_END","REQUEST_START","RESPONSE_START","RESPONSE_END","encodedLength","ENCODED_BODY_SIZE","setAttribute","HTTP_RESPONSE_CONTENT_LENGTH","decodedLength","DECODED_BODY_SIZE","HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED","sortResources","filteredResources","slice","sort","b","valueA","valueB","getResource","spanUrl","startTimeHR","endTimeHR","resources","ignoredResources","initiatorType","WeakSet","urlNormalizingAnchor","href","filterResourcesForSpan","length","mainRequest","sorted","parsedSpanUrl","parseUrl","origin","window","location","corsPreFlightRequest","findMainRequest","responseEnd","fetchStart","corsPreFlightRequestEndTime","spanEndTimeHR","spanEndTime","minTime","bestGap","i","resourceStartTime","resourceEndTime","currentGap","startTime","endTime","filter","toLowerCase","name","has","url","getElementXPath","target","optimised","nodeType","Node","DOCUMENT_NODE","targetValue","getNodeValue","indexOf","xpath","parentNode","getNodeIndex","allowedTypes","CDATA_SECTION_NODE","push","TEXT_NODE","elements","Array","from","childNodes","element","localName","index","nodeValue","ELEMENT_NODE","id","getAttribute","COMMENT_NODE","shouldPropagateTraceHeaders","propagateTraceHeaderCorsUrls","propagateTraceHeaderUrls","RegExp","some","propagateTraceHeaderUrl"],"sources":["../../src/utils.ts"],"sourcesContent":[null],"mappings":"AAAA;;;;;;;;;;;;;;;AAqBA,SAASA,sBAAsB,IAAIC,GAAG,QAAQ,gCAAgC;AAE9E,SACEC,mBAAmB,EACnBC,iBAAiB,EACjBC,UAAU,QACL,qBAAqB;AAC5B,SAASC,kBAAkB,QAAQ,qCAAqC;AAExE;AACA,IAAIC,CAAgC;AACpC,OAAM,SAAUC,uBAAuBA,CAAA;EACrC,IAAI,CAACD,CAAC,EAAE;IACNA,CAAC,GAAGE,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;;EAGjC,OAAOH,CAAC;AACV;AAEA;;;;;AAKA;AACA,OAAM,SAAUI,MAAMA,CAAIC,GAAM,EAAEC,GAAc;EAC9C,OAAOA,GAAG,IAAID,GAAG;AACnB;AAEA;;;;;;AAMA,OAAM,SAAUE,mBAAmBA,CACjCC,IAAc,EACdC,eAAuB,EACvBC,OAA2B;EAE3B,IACEN,MAAM,CAACM,OAAO,EAAED,eAAe,CAAC,IAChC,OAAOC,OAAO,CAACD,eAAe,CAAC,KAAK,QAAQ,EAC5C;IACAD,IAAI,CAACG,QAAQ,CAACF,eAAe,EAAEC,OAAO,CAACD,eAAe,CAAC,CAAC;IACxD,OAAOD,IAAI;;EAEb,OAAOI,SAAS;AAClB;AAEA;;;;;AAKA,OAAM,SAAUC,oBAAoBA,CAClCL,IAAc,EACdM,QAA4B;EAE5BP,mBAAmB,CAACC,IAAI,EAAEb,GAAG,CAACoB,WAAW,EAAED,QAAQ,CAAC;EACpDP,mBAAmB,CAACC,IAAI,EAAEb,GAAG,CAACqB,mBAAmB,EAAEF,QAAQ,CAAC;EAC5DP,mBAAmB,CAACC,IAAI,EAAEb,GAAG,CAACsB,iBAAiB,EAAEH,QAAQ,CAAC;EAC1DP,mBAAmB,CAACC,IAAI,EAAEb,GAAG,CAACuB,aAAa,EAAEJ,QAAQ,CAAC;EACtDP,mBAAmB,CAACC,IAAI,EAAEb,GAAG,CAACwB,uBAAuB,EAAEL,QAAQ,CAAC;EAChEP,mBAAmB,CAACC,IAAI,EAAEb,GAAG,CAACyB,WAAW,EAAEN,QAAQ,CAAC;EACpDP,mBAAmB,CAACC,IAAI,EAAEb,GAAG,CAAC0B,aAAa,EAAEP,QAAQ,CAAC;EACtDP,mBAAmB,CAACC,IAAI,EAAEb,GAAG,CAAC2B,cAAc,EAAER,QAAQ,CAAC;EACvDP,mBAAmB,CAACC,IAAI,EAAEb,GAAG,CAAC4B,YAAY,EAAET,QAAQ,CAAC;EACrD,IAAMU,aAAa,GAAGV,QAAQ,CAACnB,GAAG,CAAC8B,iBAAiB,CAAC;EACrD,IAAID,aAAa,KAAKZ,SAAS,EAAE;IAC/BJ,IAAI,CAACkB,YAAY,CACf3B,kBAAkB,CAAC4B,4BAA4B,EAC/CH,aAAa,CACd;;EAEH,IAAMI,aAAa,GAAGd,QAAQ,CAACnB,GAAG,CAACkC,iBAAiB,CAAC;EACrD;EACA,IAAID,aAAa,KAAKhB,SAAS,IAAIY,aAAa,KAAKI,aAAa,EAAE;IAClEpB,IAAI,CAACkB,YAAY,CACf3B,kBAAkB,CAAC+B,yCAAyC,EAC5DF,aAAa,CACd;;AAEL;AAEA;;;;AAIA,OAAM,SAAUG,aAAaA,CAACC,iBAA8C;EAC1E,OAAOA,iBAAiB,CAACC,KAAK,EAAE,CAACC,IAAI,CAAC,UAAClC,CAAC,EAAEmC,CAAC;IACzC,IAAMC,MAAM,GAAGpC,CAAC,CAACL,GAAG,CAACoB,WAAW,CAAC;IACjC,IAAMsB,MAAM,GAAGF,CAAC,CAACxC,GAAG,CAACoB,WAAW,CAAC;IACjC,IAAIqB,MAAM,GAAGC,MAAM,EAAE;MACnB,OAAO,CAAC;KACT,MAAM,IAAID,MAAM,GAAGC,MAAM,EAAE;MAC1B,OAAO,CAAC,CAAC;;IAEX,OAAO,CAAC;EACV,CAAC,CAAC;AACJ;AAEA;;;;;;;;;;AAUA,OAAM,SAAUC,WAAWA,CACzBC,OAAe,EACfC,WAAuB,EACvBC,SAAqB,EACrBC,SAAsC,EACtCC,gBAA+F,EAC/FC,aAAsB;EADtB,IAAAD,gBAAA;IAAAA,gBAAA,OAA2DE,OAAO,EAA6B;EAAA;EAG/F;EACA,IAAMC,oBAAoB,GAAG7C,uBAAuB,EAAE;EACtD6C,oBAAoB,CAACC,IAAI,GAAGR,OAAO;EACnCA,OAAO,GAAGO,oBAAoB,CAACC,IAAI;EAEnC,IAAMf,iBAAiB,GAAGgB,sBAAsB,CAC9CT,OAAO,EACPC,WAAW,EACXC,SAAS,EACTC,SAAS,EACTC,gBAAgB,EAChBC,aAAa,CACd;EAED,IAAIZ,iBAAiB,CAACiB,MAAM,KAAK,CAAC,EAAE;IAClC,OAAO;MACLC,WAAW,EAAEtC;KACd;;EAEH,IAAIoB,iBAAiB,CAACiB,MAAM,KAAK,CAAC,EAAE;IAClC,OAAO;MACLC,WAAW,EAAElB,iBAAiB,CAAC,CAAC;KACjC;;EAEH,IAAMmB,MAAM,GAAGpB,aAAa,CAACC,iBAAiB,CAAC;EAE/C,IAAMoB,aAAa,GAAGC,QAAQ,CAACd,OAAO,CAAC;EACvC,IAAIa,aAAa,CAACE,MAAM,KAAKC,MAAM,CAACC,QAAQ,CAACF,MAAM,IAAIH,MAAM,CAACF,MAAM,GAAG,CAAC,EAAE;IACxE,IAAIQ,oBAAoB,GAA0CN,MAAM,CAAC,CAAC,CAAC;IAC3E,IAAID,WAAW,GAA8BQ,eAAe,CAC1DP,MAAM,EACNM,oBAAoB,CAAC9D,GAAG,CAAC4B,YAAY,CAAC,EACtCkB,SAAS,CACV;IAED,IAAMkB,WAAW,GAAGF,oBAAoB,CAAC9D,GAAG,CAAC4B,YAAY,CAAC;IAC1D,IAAMqC,UAAU,GAAGV,WAAW,CAACvD,GAAG,CAACoB,WAAW,CAAC;IAE/C;IACA,IAAI6C,UAAU,GAAGD,WAAW,EAAE;MAC5BT,WAAW,GAAGO,oBAAoB;MAClCA,oBAAoB,GAAG7C,SAAS;;IAGlC,OAAO;MACL6C,oBAAoB,EAAAA,oBAAA;MACpBP,WAAW,EAAAA;KACZ;GACF,MAAM;IACL,OAAO;MACLA,WAAW,EAAElB,iBAAiB,CAAC,CAAC;KACjC;;AAEL;AAEA;;;;;;AAMA,SAAS0B,eAAeA,CACtBhB,SAAsC,EACtCmB,2BAAmC,EACnCC,aAAyB;EAEzB,IAAMC,WAAW,GAAGnE,mBAAmB,CAACkE,aAAa,CAAC;EACtD,IAAME,OAAO,GAAGpE,mBAAmB,CACjCC,iBAAiB,CAACgE,2BAA2B,CAAC,CAC/C;EAED,IAAIX,WAAW,GAA8BR,SAAS,CAAC,CAAC,CAAC;EACzD,IAAIuB,OAAO;EAEX,IAAMhB,MAAM,GAAGP,SAAS,CAACO,MAAM;EAC/B,KAAK,IAAIiB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGjB,MAAM,EAAEiB,CAAC,EAAE,EAAE;IAC/B,IAAMpD,QAAQ,GAAG4B,SAAS,CAACwB,CAAC,CAAC;IAC7B,IAAMC,iBAAiB,GAAGvE,mBAAmB,CAC3CC,iBAAiB,CAACiB,QAAQ,CAACnB,GAAG,CAACoB,WAAW,CAAC,CAAC,CAC7C;IAED,IAAMqD,eAAe,GAAGxE,mBAAmB,CACzCC,iBAAiB,CAACiB,QAAQ,CAACnB,GAAG,CAAC4B,YAAY,CAAC,CAAC,CAC9C;IAED,IAAM8C,UAAU,GAAGN,WAAW,GAAGK,eAAe;IAEhD,IAAID,iBAAiB,IAAIH,OAAO,KAAK,CAACC,OAAO,IAAII,UAAU,GAAGJ,OAAO,CAAC,EAAE;MACtEA,OAAO,GAAGI,UAAU;MACpBnB,WAAW,GAAGpC,QAAQ;;;EAG1B,OAAOoC,WAAW;AACpB;AAEA;;;;;;;;;AASA,SAASF,sBAAsBA,CAC7BT,OAAe,EACfC,WAAuB,EACvBC,SAAqB,EACrBC,SAAsC,EACtCC,gBAAoD,EACpDC,aAAsB;EAEtB,IAAM0B,SAAS,GAAG1E,mBAAmB,CAAC4C,WAAW,CAAC;EAClD,IAAM+B,OAAO,GAAG3E,mBAAmB,CAAC6C,SAAS,CAAC;EAC9C,IAAIT,iBAAiB,GAAGU,SAAS,CAAC8B,MAAM,CAAC,UAAA1D,QAAQ;IAC/C,IAAMqD,iBAAiB,GAAGvE,mBAAmB,CAC3CC,iBAAiB,CAACiB,QAAQ,CAACnB,GAAG,CAACoB,WAAW,CAAC,CAAC,CAC7C;IACD,IAAMqD,eAAe,GAAGxE,mBAAmB,CACzCC,iBAAiB,CAACiB,QAAQ,CAACnB,GAAG,CAAC4B,YAAY,CAAC,CAAC,CAC9C;IAED,OACET,QAAQ,CAAC8B,aAAa,CAAC6B,WAAW,EAAE,MACjC7B,aAAa,IAAI,gBAAgB,CAAC,IACrC9B,QAAQ,CAAC4D,IAAI,KAAKnC,OAAO,IACzB4B,iBAAiB,IAAIG,SAAS,IAC9BF,eAAe,IAAIG,OAAO;EAE9B,CAAC,CAAC;EAEF,IAAIvC,iBAAiB,CAACiB,MAAM,GAAG,CAAC,EAAE;IAChCjB,iBAAiB,GAAGA,iBAAiB,CAACwC,MAAM,CAAC,UAAA1D,QAAQ;MACnD,OAAO,CAAC6B,gBAAgB,CAACgC,GAAG,CAAC7D,QAAQ,CAAC;IACxC,CAAC,CAAC;;EAGJ,OAAOkB,iBAAiB;AAC1B;AAEA;;;;AAIA,OAAM,SAAUqB,QAAQA,CAACuB,GAAW;EAClC,IAAM5E,CAAC,GAAGE,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;EACrCH,CAAC,CAAC+C,IAAI,GAAG6B,GAAG;EACZ,OAAO5E,CAAC;AACV;AAEA;;;;;;AAMA;AACA,OAAM,SAAU6E,eAAeA,CAACC,MAAW,EAAEC,SAAmB;EAC9D,IAAID,MAAM,CAACE,QAAQ,KAAKC,IAAI,CAACC,aAAa,EAAE;IAC1C,OAAO,GAAG;;EAEZ,IAAMC,WAAW,GAAGC,YAAY,CAACN,MAAM,EAAEC,SAAS,CAAC;EACnD,IAAIA,SAAS,IAAII,WAAW,CAACE,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE;IAC/C,OAAOF,WAAW;;EAEpB,IAAIG,KAAK,GAAG,EAAE;EACd,IAAIR,MAAM,CAACS,UAAU,EAAE;IACrBD,KAAK,IAAIT,eAAe,CAACC,MAAM,CAACS,UAAU,EAAE,KAAK,CAAC;;EAEpDD,KAAK,IAAIH,WAAW;EAEpB,OAAOG,KAAK;AACd;AAEA;;;;AAIA,SAASE,YAAYA,CAACV,MAAmB;EACvC,IAAI,CAACA,MAAM,CAACS,UAAU,EAAE;IACtB,OAAO,CAAC;;EAEV,IAAME,YAAY,GAAG,CAACX,MAAM,CAACE,QAAQ,CAAC;EACtC,IAAIF,MAAM,CAACE,QAAQ,KAAKC,IAAI,CAACS,kBAAkB,EAAE;IAC/CD,YAAY,CAACE,IAAI,CAACV,IAAI,CAACW,SAAS,CAAC;;EAEnC,IAAIC,QAAQ,GAAGC,KAAK,CAACC,IAAI,CAACjB,MAAM,CAACS,UAAU,CAACS,UAAU,CAAC;EACvDH,QAAQ,GAAGA,QAAQ,CAACrB,MAAM,CAAC,UAACyB,OAAa;IACvC,IAAMC,SAAS,GAAID,OAAuB,CAACC,SAAS;IACpD,OACET,YAAY,CAACJ,OAAO,CAACY,OAAO,CAACjB,QAAQ,CAAC,IAAI,CAAC,IAC3CkB,SAAS,KAAKpB,MAAM,CAACoB,SAAS;EAElC,CAAC,CAAC;EACF,IAAIL,QAAQ,CAAC5C,MAAM,IAAI,CAAC,EAAE;IACxB,OAAO4C,QAAQ,CAACR,OAAO,CAACP,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;;EAEvC;EACA,OAAO,CAAC;AACV;AAEA;;;;;AAKA,SAASM,YAAYA,CAACN,MAAmB,EAAEC,SAAmB;EAC5D,IAAMC,QAAQ,GAAGF,MAAM,CAACE,QAAQ;EAChC,IAAMmB,KAAK,GAAGX,YAAY,CAACV,MAAM,CAAC;EAClC,IAAIsB,SAAS,GAAG,EAAE;EAClB,IAAIpB,QAAQ,KAAKC,IAAI,CAACoB,YAAY,EAAE;IAClC,IAAMC,EAAE,GAAGxB,MAAM,CAACyB,YAAY,CAAC,IAAI,CAAC;IACpC,IAAIxB,SAAS,IAAIuB,EAAE,EAAE;MACnB,OAAO,eAAYA,EAAE,QAAI;;IAE3BF,SAAS,GAAGtB,MAAM,CAACoB,SAAS;GAC7B,MAAM,IACLlB,QAAQ,KAAKC,IAAI,CAACW,SAAS,IAC3BZ,QAAQ,KAAKC,IAAI,CAACS,kBAAkB,EACpC;IACAU,SAAS,GAAG,QAAQ;GACrB,MAAM,IAAIpB,QAAQ,KAAKC,IAAI,CAACuB,YAAY,EAAE;IACzCJ,SAAS,GAAG,WAAW;GACxB,MAAM;IACL,OAAO,EAAE;;EAEX;EACA,IAAIA,SAAS,IAAID,KAAK,GAAG,CAAC,EAAE;IAC1B,OAAO,MAAIC,SAAS,SAAID,KAAK,MAAG;;EAElC,OAAO,MAAIC,SAAW;AACxB;AAEA;;;;;AAKA,OAAM,SAAUK,2BAA2BA,CACzClE,OAAe,EACfmE,4BAA2D;EAE3D,IAAIC,wBAAwB,GAAGD,4BAA4B,IAAI,EAAE;EACjE,IACE,OAAOC,wBAAwB,KAAK,QAAQ,IAC5CA,wBAAwB,YAAYC,MAAM,EAC1C;IACAD,wBAAwB,GAAG,CAACA,wBAAwB,CAAC;;EAEvD,IAAMvD,aAAa,GAAGC,QAAQ,CAACd,OAAO,CAAC;EAEvC,IAAIa,aAAa,CAACE,MAAM,KAAKC,MAAM,CAACC,QAAQ,CAACF,MAAM,EAAE;IACnD,OAAO,IAAI;GACZ,MAAM;IACL,OAAOqD,wBAAwB,CAACE,IAAI,CAAC,UAAAC,uBAAuB;MAC1D,OAAAhH,UAAU,CAACyC,OAAO,EAAEuE,uBAAuB,CAAC;IAA5C,CAA4C,CAC7C;;AAEL","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}