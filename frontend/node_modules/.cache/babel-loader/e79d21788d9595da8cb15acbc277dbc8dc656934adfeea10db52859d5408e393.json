{"ast":null,"code":"/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { baggageEntryMetadataFromString } from '@opentelemetry/api';\nimport { BAGGAGE_ITEMS_SEPARATOR, BAGGAGE_PROPERTIES_SEPARATOR, BAGGAGE_KEY_PAIR_SEPARATOR, BAGGAGE_MAX_TOTAL_LENGTH } from './constants';\nexport function serializeKeyPairs(keyPairs) {\n  return keyPairs.reduce(function (hValue, current) {\n    var value = \"\" + hValue + (hValue !== '' ? BAGGAGE_ITEMS_SEPARATOR : '') + current;\n    return value.length > BAGGAGE_MAX_TOTAL_LENGTH ? hValue : value;\n  }, '');\n}\nexport function getKeyPairs(baggage) {\n  return baggage.getAllEntries().map(function (_a) {\n    var key = _a[0],\n      value = _a[1];\n    return encodeURIComponent(key) + \"=\" + encodeURIComponent(value.value);\n  });\n}\nexport function parsePairKeyValue(entry) {\n  var valueProps = entry.split(BAGGAGE_PROPERTIES_SEPARATOR);\n  if (valueProps.length <= 0) return;\n  var keyPairPart = valueProps.shift();\n  if (!keyPairPart) return;\n  var keyPair = keyPairPart.split(BAGGAGE_KEY_PAIR_SEPARATOR);\n  if (keyPair.length !== 2) return;\n  var key = decodeURIComponent(keyPair[0].trim());\n  var value = decodeURIComponent(keyPair[1].trim());\n  var metadata;\n  if (valueProps.length > 0) {\n    metadata = baggageEntryMetadataFromString(valueProps.join(BAGGAGE_PROPERTIES_SEPARATOR));\n  }\n  return {\n    key: key,\n    value: value,\n    metadata: metadata\n  };\n}\n/**\n * Parse a string serialized in the baggage HTTP Format (without metadata):\n * https://github.com/w3c/baggage/blob/master/baggage/HTTP_HEADER_FORMAT.md\n */\nexport function parseKeyPairsIntoRecord(value) {\n  if (typeof value !== 'string' || value.length === 0) return {};\n  return value.split(BAGGAGE_ITEMS_SEPARATOR).map(function (entry) {\n    return parsePairKeyValue(entry);\n  }).filter(function (keyPair) {\n    return keyPair !== undefined && keyPair.value.length > 0;\n  }).reduce(function (headers, keyPair) {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    headers[keyPair.key] = keyPair.value;\n    return headers;\n  }, {});\n}","map":{"version":3,"names":["baggageEntryMetadataFromString","BAGGAGE_ITEMS_SEPARATOR","BAGGAGE_PROPERTIES_SEPARATOR","BAGGAGE_KEY_PAIR_SEPARATOR","BAGGAGE_MAX_TOTAL_LENGTH","serializeKeyPairs","keyPairs","reduce","hValue","current","value","length","getKeyPairs","baggage","getAllEntries","map","_a","key","encodeURIComponent","parsePairKeyValue","entry","valueProps","split","keyPairPart","shift","keyPair","decodeURIComponent","trim","metadata","join","parseKeyPairsIntoRecord","filter","undefined","headers"],"sources":["../../../src/baggage/utils.ts"],"sourcesContent":[null],"mappings":"AAAA;;;;;;;;;;;;;;;AAeA,SAAwCA,8BAA8B,QAAQ,oBAAoB;AAClG,SACEC,uBAAuB,EACvBC,4BAA4B,EAC5BC,0BAA0B,EAC1BC,wBAAwB,QACnB,aAAa;AAIpB,OAAM,SAAUC,iBAAiBA,CAACC,QAAkB;EAClD,OAAOA,QAAQ,CAACC,MAAM,CAAC,UAACC,MAAc,EAAEC,OAAe;IACrD,IAAMC,KAAK,GAAG,KAAGF,MAAM,IAAGA,MAAM,KAAK,EAAE,GAAGP,uBAAuB,GAAG,EAAE,IACjEQ,OAAS;IACd,OAAOC,KAAK,CAACC,MAAM,GAAGP,wBAAwB,GAAGI,MAAM,GAAGE,KAAK;EACjE,CAAC,EAAE,EAAE,CAAC;AACR;AAEA,OAAM,SAAUE,WAAWA,CAACC,OAAgB;EAC1C,OAAOA,OAAO,CACXC,aAAa,EAAE,CACfC,GAAG,CACF,UAACC,EAAY;QAAXC,GAAG,GAAAD,EAAA;MAAEN,KAAK,GAAAM,EAAA;IACV,OAAGE,kBAAkB,CAACD,GAAG,CAAC,SAAIC,kBAAkB,CAACR,KAAK,CAACA,KAAK,CAAG;EAA/D,CAA+D,CAClE;AACL;AAEA,OAAM,SAAUS,iBAAiBA,CAACC,KAAa;EAC7C,IAAMC,UAAU,GAAGD,KAAK,CAACE,KAAK,CAACpB,4BAA4B,CAAC;EAC5D,IAAImB,UAAU,CAACV,MAAM,IAAI,CAAC,EAAE;EAC5B,IAAMY,WAAW,GAAGF,UAAU,CAACG,KAAK,EAAE;EACtC,IAAI,CAACD,WAAW,EAAE;EAClB,IAAME,OAAO,GAAGF,WAAW,CAACD,KAAK,CAACnB,0BAA0B,CAAC;EAC7D,IAAIsB,OAAO,CAACd,MAAM,KAAK,CAAC,EAAE;EAC1B,IAAMM,GAAG,GAAGS,kBAAkB,CAACD,OAAO,CAAC,CAAC,CAAC,CAACE,IAAI,EAAE,CAAC;EACjD,IAAMjB,KAAK,GAAGgB,kBAAkB,CAACD,OAAO,CAAC,CAAC,CAAC,CAACE,IAAI,EAAE,CAAC;EACnD,IAAIC,QAAQ;EACZ,IAAIP,UAAU,CAACV,MAAM,GAAG,CAAC,EAAE;IACzBiB,QAAQ,GAAG5B,8BAA8B,CACvCqB,UAAU,CAACQ,IAAI,CAAC3B,4BAA4B,CAAC,CAC9C;;EAEH,OAAO;IAAEe,GAAG,EAAAA,GAAA;IAAEP,KAAK,EAAAA,KAAA;IAAEkB,QAAQ,EAAAA;EAAA,CAAE;AACjC;AAEA;;;;AAIA,OAAM,SAAUE,uBAAuBA,CAACpB,KAAc;EACpD,IAAI,OAAOA,KAAK,KAAK,QAAQ,IAAIA,KAAK,CAACC,MAAM,KAAK,CAAC,EAAE,OAAO,EAAE;EAC9D,OAAOD,KAAK,CACTY,KAAK,CAACrB,uBAAuB,CAAC,CAC9Bc,GAAG,CAAC,UAAAK,KAAK;IACR,OAAOD,iBAAiB,CAACC,KAAK,CAAC;EACjC,CAAC,CAAC,CACDW,MAAM,CAAC,UAAAN,OAAO;IAAI,OAAAA,OAAO,KAAKO,SAAS,IAAIP,OAAO,CAACf,KAAK,CAACC,MAAM,GAAG,CAAC;EAAjD,CAAiD,CAAC,CACpEJ,MAAM,CAAyB,UAAC0B,OAAO,EAAER,OAAO;IAC/C;IACAQ,OAAO,CAACR,OAAQ,CAACR,GAAG,CAAC,GAAGQ,OAAQ,CAACf,KAAK;IACtC,OAAOuB,OAAO;EAChB,CAAC,EAAE,EAAE,CAAC;AACV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}